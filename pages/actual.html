---
layout: default
title: Actual Deck
permalink: /actual/
---

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Actual Deck</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .card { perspective: 1200px }
  .card-inner {
    position: relative; transform-style: preserve-3d;
    transition: transform .5s ease;
  }
  .card[data-flipped="1"] .card-inner { transform: rotateY(180deg) }
  .face {
    position: relative; backface-visibility: hidden;
    border-radius: 1rem; border: 1px solid color-mix(in oklab, var(--card-color, #CBD5E1) 50%, #000 0%);
    background: color-mix(in oklab, var(--card-color, #F8FAFC) 12%, #fff 88%);
    box-shadow: 0 2px 12px rgba(0,0,0,.06);
    padding: 1.25rem; min-height: 14rem;
  }
  .face.back { transform: rotateY(180deg); position: absolute; inset: 0 }
  .type-pill {
    display:inline-block; padding:.125rem .5rem; border-radius:9999px;
    background: color-mix(in oklab, var(--card-color, #EEF2FF) 36%, #fff 64%);
    color:#111827; font-size:.7rem;
    border:1px solid color-mix(in oklab, var(--card-color, #CBD5E1) 50%, #000 0%);
  }
  .tag { background:#eef2ff; color:#3730a3; padding:.15rem .5rem; border-radius:9999px; font-size:.75rem }
  .flip-btn {
    border:1px solid #CBD5E1; padding:.25rem .5rem; border-radius:.5rem; font-size:.75rem;
  }
</style>
</head>
<body class="bg-white text-slate-900">
  <main class="max-w-6xl mx-auto px-4 py-8">
    <header class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <h1 class="text-2xl font-semibold">Actual Deck</h1>
        <p id="meta" class="text-sm text-slate-500">Loading…</p>
      </div>

      <div class="flex flex-col sm:flex-row gap-2 sm:items-center">
        <select id="preset" class="border rounded-lg px-3 py-2">
          <option value="">All cards</option>
        </select>
        <input id="q" type="search" placeholder="Search title, quote, tags"
               class="border rounded-lg px-3 py-2 w-full sm:w-64" />
        <button id="shuffle" class="border px-3 py-2 rounded-lg">Shuffle</button>
      </div>
    </header>

    <section id="cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></section>

    <template id="card-tpl">
      <article class="card">
        <div class="card-inner">
          <!-- FRONT -->
          <div class="face front">
            <div class="flex items-start justify-between gap-3">
              <h2 class="text-lg font-semibold" data-title></h2>
              <span class="text-xs text-slate-500" data-id></span>
            </div>
            <div class="mt-2 flex items-center gap-2">
              <span class="type-pill" data-family-pill></span>
              <button class="flip-btn" data-flip>Flip</button>
            </div>
            <blockquote class="mt-3 text-slate-800 italic" data-quote></blockquote>
            <p class="mt-1 text-sm text-slate-500" data-author></p>
            <p class="mt-4 text-sm" data-body></p>
            <div class="mt-4 flex flex-wrap gap-2" data-tags></div>
          </div>

          <!-- BACK -->
          <div class="face back">
            <div class="flex items-start justify-between gap-3">
              <h3 class="text-base font-semibold">Back</h3>
              <button class="flip-btn" data-flip>Flip</button>
            </div>
            <div class="mt-3 text-sm space-y-3" data-back></div>
          </div>
        </div>
      </article>
    </template>
  </main>

<script>
  // Config
  const JSON_BASE = "/data/actual-deck";
  const CARDS_URL = `${JSON_BASE}/cards.json`;
  const PRESETS_URL = `${JSON_BASE}/presets.json`;

  // Simple color map by type/family
  const TYPE_COLORS = {
    automation: "#dbeafe",   // blue-100
    provenance: "#fde68a",   // amber-300
    conviviality: "#bbf7d0", // green-200
    philosophy: "#e9d5ff",   // purple-200
    design: "#fecaca",       // red-200
    flow: "#bae6fd",         // sky-200
  };
  const DEFAULT_COLOR = "#e5e7eb"; // gray-200

  // State
  let ALL_CARDS = [];
  let PRESETS = [];
  let CURRENT = [];

  // Elements
  const elCards  = document.getElementById("cards");
  const elPreset = document.getElementById("preset");
  const elQ      = document.getElementById("q");
  const elMeta   = document.getElementById("meta");
  const elTpl    = document.getElementById("card-tpl");
  const elShuffle= document.getElementById("shuffle");
  const qs = new URLSearchParams(location.search);
  const cb = Date.now();

  async function fetchJSON(url){ const r=await fetch(`${url}?cb=${cb}`); if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); }
  function normalize(s){ return (s||"").toLowerCase(); }
  function pickColor(family){
    const key = normalize(family||"");
    return TYPE_COLORS[key] || DEFAULT_COLOR;
  }

  function renderCards(list){
    elCards.innerHTML = "";
    if(!list.length){ elCards.innerHTML = `<p class="text-slate-600">No cards match.</p>`; return; }

    const frag = document.createDocumentFragment();
    for(const c of list){
      const node = elTpl.content.cloneNode(true);
      const root = node.querySelector("article.card");
      const color = pickColor(c.family || c.type);
      root.style.setProperty("--card-color", color);

      node.querySelector("[data-title]").textContent = c.title || "(untitled)";
      node.querySelector("[data-id]").textContent = c.id || "";
      node.querySelector("[data-quote]").textContent = c.quote || "";
      node.querySelector("[data-author]").textContent = c.author ? `— ${c.author}` : "";
      node.querySelector("[data-body]").textContent = c.body || "";

      const pill = node.querySelector("[data-family-pill]");
      pill.textContent = c.family || c.type || "unspecified";

      // Tags
      const tagsWrap = node.querySelector("[data-tags]");
      (c.tags || []).forEach(t => {
        const s = document.createElement("span");
        s.className = "tag";
        s.textContent = t;
        s.dataset.tag = t;
        s.addEventListener("click", () => { elQ.value = t; applyFilters(); });
        tagsWrap.appendChild(s);
      });

      // Back content strategy:
      // prefer c.back; fallback to c.notes or c.details; else show a structured summary.
      const backEl = node.querySelector("[data-back]");
      const back =
        c.back || c.notes || c.details ||
        [
          c.principle ? `<p><strong>Principle:</strong> ${c.principle}</p>` : "",
          c.context ? `<p><strong>Context:</strong> ${c.context}</p>` : "",
          c.actions?.length ? `<div><strong>Actions</strong><ul class="list-disc pl-5">${c.actions.map(a=>`<li>${a}</li>`).join("")}</ul></div>` : "",
          c.references?.length ? `<div><strong>References</strong><ul class="list-disc pl-5">${c.references.map(r=>`<li>${r}</li>`).join("")}</ul></div>` : "",
        ].filter(Boolean).join("") ||
        `<pre class="text-xs bg-white/50 p-2 rounded border">${escapeHtml(JSON.stringify(c, null, 2))}</pre>`;
      backEl.innerHTML = back;

      // Flip handlers
      node.querySelectorAll("[data-flip]").forEach(btn => {
        btn.addEventListener("click", () => {
          const flipped = root.getAttribute("data-flipped")==="1" ? "0" : "1";
          root.setAttribute("data-flipped", flipped);
        });
      });

      // Also flip by clicking anywhere on the card except links/buttons
      node.querySelector(".card-inner").addEventListener("click", (e) => {
        if (e.target.closest("button,a")) return;
        const flipped = root.getAttribute("data-flipped")==="1" ? "0" : "1";
        root.setAttribute("data-flipped", flipped);
      });

      frag.appendChild(node);
    }
    elCards.appendChild(frag);
    elMeta.textContent = `Cards: ${list.length} • Total: ${ALL_CARDS.length} • Presets: ${PRESETS.length}`;
  }

  function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function applyFilters(){
    const q = normalize(elQ.value);
    const presetId = elPreset.value;
    let base = [...ALL_CARDS];

    if (presetId) {
      const preset = PRESETS.find(p => p.id === presetId);
      const set = new Set((preset?.cards)||[]);
      base = base.filter(c => set.has(c.id));
    }

    if (q) {
      base = base.filter(c => {
        const hay = [
          c.title, c.quote, c.author, c.body, c.family, c.type,
          ...(c.tags || [])
        ].map(normalize).join(" • ");
        return hay.includes(q);
      });
    }

    CURRENT = base;
    renderCards(CURRENT);

    const next = new URL(location);
    if (presetId) next.searchParams.set("preset", presetId); else next.searchParams.delete("preset");
    if (q) next.searchParams.set("q", q); else next.searchParams.delete("q");
    history.replaceState({}, "", next);
  }

  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }

  // Events
  document.getElementById("preset").addEventListener("change", applyFilters);
  document.getElementById("q").addEventListener("input", applyFilters);
  document.getElementById("shuffle").addEventListener("click", () => { shuffle(CURRENT); renderCards(CURRENT); });

  // Boot
  (async function init(){
    try{
      const [cards, presets] = await Promise.all([
        fetchJSON(CARDS_URL),
        fetchJSON(PRESETS_URL).catch(()=>[])
      ]);
      ALL_CARDS = Array.isArray(cards)?cards:[];
      PRESETS = Array.isArray(presets)?presets:[];
      PRESETS.forEach(p => {
        const opt=document.createElement("option"); opt.value=p.id; opt.textContent=p.name||p.id; elPreset.appendChild(opt);
      });

      const initPreset = qs.get("preset"); const initQ = qs.get("q");
      if (initPreset) document.getElementById("preset").value = initPreset;
      if (initQ) document.getElementById("q").value = initQ;

      applyFilters();
    }catch(e){
      elMeta.textContent = `Error: ${e.message}`;
      elCards.innerHTML = `<p class="text-red-700">Failed to load JSON from ${JSON_BASE}.</p>`;
    }
  })();
</script>
</body>
</html>

